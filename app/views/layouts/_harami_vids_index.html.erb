
<%# local variables: harami_vids %>

<div id="harami_vids">
<table id="harami_vids_index_table">
  <thead>
    <tr>
     <% if can? :update, HaramiVid %>
      <th>ID</th>
     <% end %>
      <th>Channel</th>
      <th>Title</th>
      <th>Date</th>
     <% if can? :update, Harami1129 %>
      <th title="Number of Harami1129 entries"># H1129s</th>
     <% end %>
      <th><%= t("Musics") %></th>
      <% if can? :read, EventItem %>
      <th>EventItems</th>
      <% end %>
      <th title="Note in this DB">Note</th>
      <% if can? :update, HaramiVid %>
        <th colspan="2"></th>  <%#  HaramiVid should not be easily destroyed from Index %>
      <% else %>
        <th></th>
      <% end %>
    </tr>
  </thead>

  <% event_items = [] %>
  <tbody>
    <% harami_vids.each do |harami_vid| %>
      <tr>
     <% if can? :update, HaramiVid %>
        <td><%= link_to harami_vid.id, harami_vid %></td>
     <% end %>
        <td><%= harami_vid.channel.channel_owner.title_or_alt(langcode: I18n.locale, lang_fallback_option: :either, prefer_alt: true) %> </td>
        <td><%= link_to_youtube harami_vid.title_or_alt(langcode: I18n.locale, lang_fallback_option: :either), harami_vid.uri %></td>
        <td><%= harami_vid.release_date %></td>
     <% if can? :update, Harami1129 %>
        <td><%= harami_vid.harami1129s.count %></td>
     <% end %>
        <td><%= harami_vid.musics.map{ |music|
               mu_tit = music.title_or_alt(langcode: I18n.locale, lang_fallback_option: :either)
               (can?(:read, music) ? link_to(mu_tit, music) : mu_tit)
             }.join(t('comma')).html_safe %>
        </td>
      <% if can? :read, EventItem %>
        <td>
          <%= harami_vid.event_items.map{ |eei|
             if !(ind=event_items.find_index(eei))
               event_items << eei
               ind = event_items.size-1
             end
             ind += 1
             link_to(ind.to_s, eei, title: eei.machine_title)
             }.join(", ").html_safe %>
        </td>
      <% end %>
        <td><%= harami_vid.note %></td>

        <td><%= link_to "Show", harami_vid %></td>
        <% if can? :update, harami_vid  %>
          <td><%= link_to 'Edit', edit_harami_vid_path(harami_vid) %></td>
        <% end %>
      </tr>
    <% end %>
  </tbody>
</table>
</div>

